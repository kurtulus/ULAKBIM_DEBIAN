#!/bin/bash
echo "APACHE konfigürasyonları yapılandırılıyor...";
a2enmod headers;
a2enmod rewrite;
cp /tmp/APACHE/zkitapeditoru_apache.conf /etc/apache2/sites-available/zkitapeditoru_apache.conf;
echo "127.0.0.1	zkitapeditoru.com" >> /etc/hosts;
a2ensite zkitapeditoru_apache.conf;
service apache2 reload;
service apache2 restart;

echo "MYSQL konfigürasyonları yapılandırılıyor..."
mysql -u root -p</tmp/MYSQL/ulakbim_editor.sql 

echo "NODEJS kuruluyor...";
nodejs=`which node`;
if ["$nodejs" == ""]; then
	cd /tmp/NODEJS/node-v0.10.33;
	./configure > /dev/null;
	make > /dev/null;
	make install > /dev/null;
fi


echo "COWORKING kuruluyor...";
cd /tmp/NODEJS/coworking/;
sh cowork_install;
cd /var/www/coworking;

npm config set registry http://registry.npmjs.org/;
echo "SOCKET.IO kuruluyor..."
npm install socket.io;
service cowork restart;

architecture=`getconf LONG_BIT`;

if [ "$architecture" == "32" ]; then
	cp /tmp/ZKITAPEDITORU/zkitapeditoru_32 /usr/bin/zkitapeditoru;
	chmod -R 777 /var/lib/cef-32/;
else
	cp /tmp/ZKITAPEDITORU/zkitapeditoru_64 /usr/bin/zkitapeditoru;
	chmod -R 777 /var/lib/cef-64/;
fi

chmod 755 /usr/bin/zkitapeditoru

echo "MASAÜSTÜ kısayolu oluşturuluyor..."
cp /usr/share/applications/zkitapeditoru.desktop $(xdg-user-dir DESKTOP)
